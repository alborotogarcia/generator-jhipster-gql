/* eslint-disable id-blacklist */
import { Args, Query, Resolver, Mutation, Subscription } from '@nestjs/graphql';
import { <%= entityClass %>Service } from '../../service/<%= entityFileName %>.service';
import { PaginationArgs } from './pagination-util';
import { Create<%= entityClass %>Args, Update<%= entityClass %>Args } from '../../service/graphql/<%= entityFileName %>.input-type';
import { <%= entityClass %>, Paginated<%= entityClass %> } from '../../service/graphql/<%= entityFileName %>.object-type';
import { PageRequest } from '../../domain/base/pagination.entity';
import { pageRequestToFindManyOptions } from './pagination-util';
import { PubSubAction, PubSubService } from '../../service/graphql/pub-sub.service';

<%_
const pkTypeInterface = getPkType(databaseType) === 'Long' ? 'Number' : 'String';
const pkType = pkTypeInterface.toLowerCase();
_%>

@Resolver()
export class <%= entityClass %>Resolver {
constructor(private <%= asEntity(entityInstance) %>Service: <%= entityClass %>Service, private pubSub: PubSubService) {}

  @Query(() => Paginated<%= entityClass %>)
  async get<%= entityClass %>s(@Args() options: PaginationArgs): Promise<Paginated<%= entityClass %>> {
    const pageRequest: PageRequest = new PageRequest(options.page, options.size, options.sort);
    return this.<%= asEntity(entityInstance) %>Service.findAndCount(pageRequestToFindManyOptions(pageRequest))
        .then(([results, count]) => new Paginated<%= entityClass %>(results, count, true));
  }

  @Query(() => <%= entityClass %>)
  async get<%= entityClass %>(@Args('id') id: <%= pkType %>): Promise<<%= entityClass %>> {
    return this.<%= asEntity(entityInstance) %>Service.findById(id)
  }

  @Mutation(() => <%= entityClass %>)
  async create<%= entityClass %>(@Args('<%= entityInstance %>') <%= entityInstance %>: Create<%= entityClass %>Args): Promise<<%= entityClass %>> {
    return await this.<%= asEntity(entityInstance) %>Service.save(<%= entityInstance %>);
  }

  @Mutation(() => <%= entityClass %>)
  async update<%= entityClass %>(@Args('<%= entityInstance %>') <%= entityInstance %>: Update<%= entityClass %>Args): Promise<<%= entityClass %>> {
    return await this.<%= asEntity(entityInstance) %>Service.update(<%= entityInstance %>);
  }

  @Mutation(() => <%= pkTypeInterface %>)
  async delete<%= entityClass %>(@Args('id') id: <%= pkType %>): Promise<<%= pkType %>> {
    await this.<%= asEntity(entityInstance) %>Service.deleteById(id);
    return id;
  }

  @Subscription(() => <%= entityClass %>)
  <%= entityInstance %>Added(): AsyncIterator<<%= entityClass %>> {
    return this.pubSub.asyncIterator('<%= entityInstance%>', PubSubAction.ADD);
  }

  @Subscription(() => <%= entityClass %>)
  <%= entityInstance %>Updated(): AsyncIterator<<%= entityClass %>> {
    return this.pubSub.asyncIterator('<%= entityInstance%>', PubSubAction.UPDATE);
  }

  @Subscription(() => <%= pkTypeInterface%>)
  <%= entityInstance %>Deleted(): AsyncIterator<<%= pkType %>> {
    return this.pubSub.asyncIterator('<%= entityInstance%>', PubSubAction.DELETE);
  }
}

