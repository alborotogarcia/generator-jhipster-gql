import { Global, Module } from '@nestjs/common';
import { GraphQLModule as NestJSGraphQLModule } from '@nestjs/graphql';
import { join } from 'path';
import { PubSubService } from '../service/graphql/pub-sub.service';

@Global()
@Module({
    imports: [
        NestJSGraphQLModule.forRoot({
            installSubscriptionHandlers: true,
            autoSchemaFile: join(process.cwd(), '..', '<%= schemaLocation %>'),
            buildSchemaOptions: {
                numberScalarMode: 'integer',
            },
            context: (ctx) => ({ req: ctx.req || ctx.connection.context }),
        }),
    ],
    providers: [PubSubService],
    exports: [PubSubService],
})
export class GraphQLModule {}
