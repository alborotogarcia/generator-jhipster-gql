import { ApolloClient, InMemoryCache, ApolloLink, from, HttpLink } from '@apollo/client';

function createOmitTypenameLink() {
  return new ApolloLink((operation, forward) => {
    if (operation.variables) {
      operation.variables = JSON.parse(JSON.stringify(operation.variables), omitTypename)
    }
    return forward(operation)
  })
}

function omitTypename(key, value) {
  return key === '__typename' ? undefined : value
}

const httpLink = new HttpLink({uri: '<%= endpoint %>'});
const omitTypenameLink = createOmitTypenameLink();

export const client = new ApolloClient({cache: new InMemoryCache(), link: from([omitTypenameLink ,httpLink]) });
